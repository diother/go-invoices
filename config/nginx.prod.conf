worker_processes auto;

events {
    worker_connections 1024;
}

http {
    include mime.types;
    default_type application/octet-stream;

    sendfile on;
    keepalive_timeout 65;

    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    gzip_min_length 1000;

    server {
            listen 443 ssl;
            server_name app.hintermann.ro;

            ssl_certificate /etc/letsencrypt/live/app.hintermann.ro/fullchain.pem;
            ssl_certificate_key /etc/letsencrypt/live/app.hintermann.ro/privkey.pem;
            include /etc/letsencrypt/options-ssl-nginx.conf;
            ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

            location / {
                    proxy_pass http://app:8080;
                    proxy_set_header Host $host;
                    proxy_set_header X-Real-IP $remote_addr;
                    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                    proxy_set_header X-Forwarded-Proto $scheme;
            }

            location /static/ {
                    alias /usr/share/nginx/html/static/;
                    expires 30d;
                    add_header Cache-Control "public, max-age=31536000";
            }

            location = /favicon.ico {
                    access_log off;
                    log_not_found off;
                    expires 1w;
                    add_header Cache-Control "public, max-age=604800";
                    alias /usr/share/nginx/html/static/images/favicon.ico;
            }
    }

    server {
            listen 80;
            server_name app.hintermann.ro;

            if ($host = app.hintermann.ro) {
                    return 301 https://$host$request_uri;
            }
            return 404;
    }
}
